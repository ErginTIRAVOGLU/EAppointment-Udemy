<div class="mt-2 d-flex justify-content-beetween align-items-center">
    <h3>Welcome to e-Appointment Application</h3>
</div>
<div class="mt-3">
     <div class="form-group">
        <div class="row">
            <div class="col-xl-9 col-lg-8 col-md-6 col-sm-12 col-12">
                @if( selectedDoctorId() != '0' )
                {
                    <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addModal">
                        <i class="fa-solid fa-plus me-1"></i> 
                        <span>Add Appointment</span>
                    </button>
                }                
            </div>
            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 col-12 position-relative">
                @if(appointments().length > 0)
                {   
                    <input [(ngModel)]="search" type="search" class="form-control" placeholder="Search appointment...">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                }                
            </div>
        </div>
     </div>
</div>

<div class="mt-2">
    <div class="row">
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-12 mt-1">
            <label>Department</label>
            <select [ngModel]="selectedDepartmentValue()" (ngModelChange)="onDepartmentChange($event)" name="department" class="form-select">
                <option [value]="0">All Departments</option>
                @for(department of departments();track department)
                {
                    <option [value]="department.value">{{department.name}}</option>
                }
            </select>
        </div> 
        @if(showDoctorSelect())
        {
            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-12 mt-1">
                <label>Doctor</label>
                @if(doctors().length == 0){
                    <input class="form-control" value="No doctors available" disabled />
                } @else { 
                    <select [ngModel]="selectedDoctorId()" (ngModelChange)="onDoctorChange($event);" name="doctor" class="form-select">
                        <option [value]="0">All Doctors</option>
                        @for(doctor of doctors();track doctor)
                        {
                            <option [value]="doctor.id">{{doctor.fullName}}</option>
                        }
                    </select>
                }
                
            </div> 
        }
         
    </div>

    <div class="mt-2">
        @if(appointments().length == 0){
            <label>No appointments found.</label>
        } @else {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Start Date</th>
                        <th scope="col">End Date</th>
                        <th scope="col">Title</th>
                        <th scope="col">Detail</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @for(appointment of appointments() | appointment : search() ; track appointment){
                        <tr >
                            <th scope="row">{{$index +1}}</th>
                            <td>{{appointment.startDate | date:'dd MMMM yyyy HH:mm'}}</td>
                            <td>{{appointment.endDate | date:'dd MMMM yyyy HH:mm'}}</td>
                            <td>{{appointment.title}}</td>
                             <td>
                                <button class="btn btn-success btn-sm" (click)="openAppointmentDetailModal(appointment)" data-bs-toggle="modal" data-bs-target="#detailModal" >
                                    <i class="fa-solid fa-info"></i>
                                </button>
                            </td>
                            <td>
                                <button class="btn btn-primary btn-sm" (click)="openAppointmentEditModal(appointment.id)" data-bs-toggle="modal" data-bs-target="#updateModal">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                            </td>
                            <td>
                                <button class="btn btn-danger btn-sm" (click)="deleteAppointment(appointment.id, appointment.title)">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }            
    </div>
</div>



<!-- Create Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addModalLabel">Add Appointment</h1>
        <button type="button" #addModalCloseButton class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #addForm="ngForm" formValidate (ngSubmit)="add(addForm)" >
        <div class="modal-body">
            <div class="form-group">
                <label for="identityNumber" class="form-label">Identity Number</label>
                <input (keydown)="getPatient($event)" [(ngModel)]="appointmentCreateFormModel().IdentityNumber" name="identityNumber" type="text" id="identityNumber" class="form-control" placeholder="Enter identity number" required="">
                <div class="invalid-feedback">
                    Please provide a valid identity number.
                </div>
            </div>
            <div class="form-group">
                <label for="firstName" class="form-label">First Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentCreateFormModel().FirstName" name="firstName" type="text" id="firstName" class="form-control" placeholder="Enter first name" required="">
                <div class="invalid-feedback">
                    Please provide a valid first name.
                </div>
            </div>
            <div class="form-group">
                <label for="lastName" class="form-label">Last Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentCreateFormModel().LastName" name="lastName" type="text" id="lastName" class="form-control" placeholder="Enter last name" required="">
                <div class="invalid-feedback">
                    Please provide a valid last name.
                </div>
            </div>
           <div class="form-group">
                <label for="patientCity" class="form-label">Patient City</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentCreateFormModel().City" name="patientCity" type="text" id="patientCity" class="form-control" placeholder="Enter patient city" required="">
                <div class="invalid-feedback">
                    Please provide a valid patient city.
                </div>
            </div>
             <div class="form-group">
                <label for="patientTown" class="form-label">Patient Town</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentCreateFormModel().Town" name="patientTown" type="text" id="patientTown" class="form-control" placeholder="Enter patient town" required="">
                <div class="invalid-feedback">
                    Please provide a valid patient town.
                </div>
            </div>
             <div class="form-group">
                <label for="patientFullAddress" class="form-label">Patient Full Address</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentCreateFormModel().FullAddress" name="patientFullAddress" type="text" id="patientFullAddress" class="form-control" placeholder="Enter patient full address" required="">
                <div class="invalid-feedback">
                    Please provide a valid patient full address.
                </div>
            </div>
            <div class="form-group">
                <label for="startDate" class="form-label">Start Date</label>
                <input [(ngModel)]="appointmentCreateFormModel().startDate" name="startDate" type="datetime-local" id="startDate" class="form-control" placeholder="Enter start date" required="">
                <div class="invalid-feedback">
                    Please provide a valid start date.
                </div>
            </div>
            <div class="form-group">
                <label for="endDate" class="form-label">End Date</label>
                <input [(ngModel)]="appointmentCreateFormModel().endDate" name="endDate" type="datetime-local" id="endDate" class="form-control" placeholder="Enter end date" required="">
                <div class="invalid-feedback">
                    Please provide a valid end date.
                </div>
            </div>
        </div>
        <div class="modal-footer"> 
            <button type="submit" class="btn btn-dark w-100">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
    
<!-- Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="updateModalLabel">Update Appoinntment</h1>
        <button type="button" #updateModalCloseButton class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #updateForm="ngForm" formValidate (ngSubmit)="update(updateForm)" >
        <div class="modal-body">           
             <div class="form-group">
                <label for="identityNumber" class="form-label">Identity Number</label>
                <input (keydown)="getPatient($event)" [(ngModel)]="appointmentUpdateFormModel().identityNumber" name="identityNumber" type="text" id="identityNumber" class="form-control" placeholder="Enter identity number" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid identity number.
                </div>
            </div>
            <div class="form-group">
                <label for="firstName" class="form-label">First Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().firstName" name="firstName" type="text" id="firstName" class="form-control" placeholder="Enter first name" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid first name.
                </div>
            </div>
            <div class="form-group">
                <label for="lastName" class="form-label">Last Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().lastName" name="lastName" type="text" id="lastName" class="form-control" placeholder="Enter last name" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid last name.
                </div>
            </div>
           <div class="form-group">
                <label for="patientCity" class="form-label">Patient City</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().city" name="patientCity" type="text" id="patientCity" class="form-control" placeholder="Enter patient city" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient city.
                </div>
            </div>
             <div class="form-group">
                <label for="patientTown" class="form-label">Patient Town</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().town" name="patientTown" type="text" id="patientTown" class="form-control" placeholder="Enter patient town" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient town.
                </div>
            </div>
             <div class="form-group">
                <label for="patientFullAddress" class="form-label">Patient Full Address</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().fullAddress" name="patientFullAddress" type="text" id="patientFullAddress" class="form-control" placeholder="Enter patient full address" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient full address.
                </div>
            </div>
            <div class="form-group">
                <label for="startDate" class="form-label">Start Date</label>
                <input [(ngModel)]="appointmentUpdateFormModel().startDate" name="updateStartDate" type="datetime-local" id="updateStartDate" class="form-control" placeholder="Enter start date" required="">
                <div class="invalid-feedback">
                    Please provide a valid start date.
                </div>
            </div>
            <div class="form-group">
                <label for="endDate" class="form-label">End Date</label>
                <input [(ngModel)]="appointmentUpdateFormModel().endDate" name="updateEndDate" type="datetime-local"  id="updateEndDate" class="form-control" placeholder="Enter end date" required="">
                <div class="invalid-feedback">
                    Please provide a valid end date.
                </div>
            </div>
        </div>
        <div class="modal-footer"> 
            <button type="submit" class="btn btn-primary w-100">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="detailModalLabel">Appointment Detail</h1>
        <button type="button" #detailModalCloseButton class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #detailForm="ngForm"  >
        <div class="modal-body">
            <div class="form-group">
                <label for="doctorFullName" class="form-label">Doctor FullName</label>
                <input [(ngModel)]="appointmentUpdateFormModel().doctorFullName" name="doctorFullName" type="text" id="doctorFullName" class="form-control" placeholder="Enter doctor full name" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid doctor full name.
                </div>
            </div>       
            <div class="form-group">
                <label for="identityNumber" class="form-label">Identity Number</label>
                <input (keydown)="getPatient($event)" [(ngModel)]="appointmentUpdateFormModel().identityNumber" name="identityNumber" type="text" id="identityNumber" class="form-control" placeholder="Enter identity number" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid identity number.
                </div>
            </div>
            <div class="form-group">
                <label for="firstName" class="form-label">First Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().firstName" name="firstName" type="text" id="firstName" class="form-control" placeholder="Enter first name" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid first name.
                </div>
            </div>
            <div class="form-group">
                <label for="lastName" class="form-label">Last Name</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().lastName" name="lastName" type="text" id="lastName" class="form-control" placeholder="Enter last name" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid last name.
                </div>
            </div>
           <div class="form-group">
                <label for="patientCity" class="form-label">Patient City</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().city" name="patientCity" type="text" id="patientCity" class="form-control" placeholder="Enter patient city" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient city.
                </div>
            </div>
             <div class="form-group">
                <label for="patientTown" class="form-label">Patient Town</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().town" name="patientTown" type="text" id="patientTown" class="form-control" placeholder="Enter patient town" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient town.
                </div>
            </div>
             <div class="form-group">
                <label for="patientFullAddress" class="form-label">Patient Full Address</label>
                <input [disabled]="isPatientFound()" [(ngModel)]="appointmentUpdateFormModel().fullAddress" name="patientFullAddress" type="text" id="patientFullAddress" class="form-control" placeholder="Enter patient full address" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid patient full address.
                </div>
            </div>
            <div class="form-group">
                <label for="startDate" class="form-label">Start Date</label>
                <input [(ngModel)]="appointmentUpdateFormModel().startDate" name="updateStartDate" type="text" id="updateStartDate" class="form-control" placeholder="Enter start date" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid start date.
                </div>
            </div>
            <div class="form-group">
                <label for="endDate" class="form-label">End Date</label>
                <input [(ngModel)]="appointmentUpdateFormModel().endDate" name="updateEndDate" type="text" id="updateEndDate" class="form-control" placeholder="Enter end date" disabled="">
                <div class="invalid-feedback">
                    Please provide a valid end date.
                </div>
            </div>
        </div> 
      </form>
    </div>
  </div>
</div>